<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoundCloud Music Player</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
        }
        button {
            padding: 10px 20px;
            background-color: #ff5500;
            color: white;
            border: none;
            cursor: pointer;
        }
        audio {
            width: 100%;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>SoundCloud Music Player</h1>
    <p>Enter a SoundCloud track URL and click Play. This uses a public proxy to bypass potential blocks on SoundCloud.</p>
    <input id="url" type="text" placeholder="https://soundcloud.com/artist/track">
    <button onclick="playMusic()">Play</button>
    <audio id="audio" controls></audio>

    <script>
        const clientId = '2t9loNQH90kzJcsFCODdigxfp325aq4z';
        const proxyBase = 'https://allorigins.win/get?url=';
        const proxyRaw = 'https://allorigins.win/raw?url=';

        async function fetchProxied(url) {
            try {
                const response = await fetch(proxyBase + encodeURIComponent(url));
                const data = await response.json();
                if (data.status.http_code !== 200) {
                    throw new Error(`Proxy error: ${data.status.http_code}`);
                }
                return JSON.parse(data.contents);
            } catch (error) {
                console.error('Fetch error:', error);
                throw error;
            }
        }

        async function getStreamUrl(trackUrl) {
            const resolveUrl = `https://api.soundcloud.com/resolve?url=${encodeURIComponent(trackUrl)}&client_id=${clientId}`;
            const track = await fetchProxied(resolveUrl);

            const transcodings = track.media.transcodings;
            const mp3Trans = transcodings.find(t => t.format.protocol === 'progressive' && t.format.mime_type.includes('mpeg'));

            if (!mp3Trans) {
                throw new Error('No suitable MP3 stream found');
            }

            const streamInfoUrl = `${mp3Trans.url}?client_id=${clientId}`;
            const streamInfo = await fetchProxied(streamInfoUrl);

            return streamInfo.url;
        }

        async function playMusic() {
            const trackUrl = document.getElementById('url').value.trim();
            if (!trackUrl) {
                alert('Please enter a SoundCloud URL');
                return;
            }

            try {
                const mediaUrl = await getStreamUrl(trackUrl);
                const proxiedMedia = proxyRaw + encodeURIComponent(mediaUrl);
                const audio = document.getElementById('audio');
                audio.src = proxiedMedia;
                audio.load();
                audio.play();
            } catch (error) {
                alert('Error loading track: ' + error.message);
            }
        }
    </script>
</body>
</html>
